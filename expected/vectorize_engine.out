--
-- Regression Tests for Custom Plan APIs
--
-- construction of test data
CREATE TABLE t1 (
    a   int,
	b	double precision
);
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Greenplum Database data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
INSERT INTO t1 SELECT generate_series(1,3), 2.3;
INSERT INTO t1 SELECT generate_series(1,3), 3.3;
INSERT INTO t1 SELECT generate_series(1,3), 4.3;
VACUUM ANALYZE t1;
create extension vectorize_engine;
SET enable_vectorize_engine TO on;
SELECT * FROM t1;
 a |  b  
---+-----
 1 | 2.3
 2 | 2.3
 3 | 2.3
 1 | 3.3
 2 | 3.3
 3 | 3.3
 1 | 4.3
 2 | 4.3
 3 | 4.3
(9 rows)

SELECT b FROM t1;
  b  
-----
 2.3
 2.3
 2.3
 3.3
 3.3
 3.3
 4.3
 4.3
 4.3
(9 rows)

SELECT b+1 FROM t1;
 ?column? 
----------
      3.3
      3.3
      3.3
      4.3
      4.3
      4.3
      5.3
      5.3
      5.3
(9 rows)

SELECT a, sum(b), avg(b)  FROM t1 group by a;
 a | sum | avg 
---+-----+-----
 1 | 9.9 | 3.3
 2 | 9.9 | 3.3
 3 | 9.9 | 3.3
(3 rows)

SELECT a, sum(b), avg(b)  FROM t1 where a < 3 group by a;
 a | sum | avg 
---+-----+-----
 1 | 9.9 | 3.3
 2 | 9.9 | 3.3
(2 rows)

-- plain agg not supported yet
SELECT count(b) FROM t1;
NOTICE:  query can't be vectorized (vectorEngine.c:88)
DETAIL:  Non hash agg is not supported yet
 count 
-------
     9
(1 row)

drop extension vectorize_engine;
